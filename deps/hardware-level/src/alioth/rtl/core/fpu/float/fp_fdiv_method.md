# 浮点除法与开方实现方法解读

本模块实现了 IEEE754 浮点数的除法（fdiv）和开方（fsqrt）功能，支持单精度和双精度。其核心思想是采用查找表（LUT）获得初始近似值，然后通过牛顿-拉夫森迭代法（Newton-Raphson）进行高精度求解。主要流程如下：

---

## 一、除法实现流程

1. **输入与特殊情况处理**  
   - 判断输入操作类型（除法/开方），并对 NaN、无穷、零等特殊情况进行分类处理，设置异常标志。

2. **初始近似倒数查找**  
   - 通过查找表（reciprocal_lut）根据被除数高位获得初始倒数近似值 y。

3. **牛顿-拉夫森迭代求倒数**  
   - 设 A 为被除数，B 为除数，y 为 B 的倒数近似值。
   - 迭代步骤如下（每一步都用 MAC 单元实现）：
     1. 计算初始误差 e0 = 1 - B*y
     2. y0 = y + y*e0
     3. e1 = e0*e0
     4. y1 = y0 + y0*e1
     5. e2 = e1*e1
     6. y2 = y1 + y1*e2
   - 经过三次迭代后，y2 已为高精度倒数。

4. **求商与修正**  
   - 初步商 q0 = A*y2
   - 计算余数 r0 = A - q0*B
   - 修正商 q0 = q0 + r0*y2
   - 再次计算余数 r1 = A - q0*B
   - 若 r1 > 0，商加一，最后再判断余数是否为零，必要时再修正一次。

5. **规格化与舍入**  
   - 对结果尾数进行规格化（左移/右移），调整阶码。
   - 提取 GRS 位，准备后续舍入。
   - 输出最终结果和异常标志。

---

## 二、开方实现流程

1. **输入与特殊情况处理**  
   - 判断输入操作类型（开方），并对 NaN、无穷、负数等特殊情况进行分类处理，设置异常标志。

2. **初始近似倒数根查找**  
   - 通过查找表（reciprocal_root_lut）根据输入高位获得初始倒数根近似值 y。

3. **牛顿-拉夫森迭代求倒数根**  
   - 设 A 为被开方数，y 为初始倒数根近似值。
   - 迭代步骤如下（每一步都用 MAC 单元实现）：
     1. y0 = y*A
     2. h0 = y*0.5
     3. e0 = 0.5*h0 + y0
     4. y1 = y0 + y0*e0
     5. h1 = h0*h0 + e0
     6. e1 = 0.5*h1 + y1
     7. y2 = y1 + y1*e1
     8. h2 = h1*h1 + e1
   - 经过多次迭代后，y2 已为高精度倒数根。

4. **求根与修正**  
   - 初步根 r0 = A*y2 + y2
   - 高阶修正 y3 = y2*h2 + r0
   - 进一步修正 r0 = A*y3 + y3
   - 最终根近似 q0 = y3*h2 + r0
   - 计算最终余数 r1 = A*q0 + q0
   - 若 r1 > 0，根加一，最后再判断余数是否为零，必要时再修正一次。

5. **规格化与舍入**  
   - 对结果尾数进行规格化（左移/右移），调整阶码。
   - 提取 GRS 位，准备后续舍入。
   - 输出最终结果和异常标志。

---

## 三、总结

- 本模块采用查表+多步牛顿-拉夫森迭代，兼顾了速度和精度。
- 所有乘加操作均通过内部 MAC 单元流水线实现，便于硬件高效实现。
- 规格化、舍入和异常处理严格遵循 IEEE754 标准。
- 结构清晰，便于扩展和维护。

